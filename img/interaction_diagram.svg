<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="1285" height="1990" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[
Participant AssetLog
Participant Browser
Participant Adobe API

note right of Browser: User visits https://assetlog.example.com

Browser->AssetLog: GET /
AssetLog-->Browser: HTML + index.js

note right of Browser: Upon page load it will use the Adobe Creative SDK\n to check if the user is alread authenticated.

Browser->Adobe API: CreativeSDK.getAuthStatus()
Adobe API-->Browser: AuthStatus: not logged in

note right of Browser: User clicks "Log in with Adobe"

Browser->Adobe API: CreativeSDK.login()
note right of Browser: Opens a popup window to request authentication.\nWhen that's done, it gets redirected to /redirectims.html

Browser->AssetLog: (popup window) GET /redirectims.html
AssetLog-->Browser: HTML + csdk_auth.js
note right of Browser: This page includes some JavaScript provided by\n Adobe. It sends a message to the original \n window that login has succeeded, then closes\n the popup window.

Adobe API-->Browser: Auth OK, close popup

Browser->AssetLog: POST /authenticate (ajax)
note right of AssetLog: Authentication up to this point  was strictly\n on the frontend. With this call the server\n gets notified that authenication has succeeded, \nand receives the authentication token, which\n it can use to make API calls.

note right of AssetLog: On the server side, do an API call to Adobe to\n validate the authentication token, and to get\n the corresponding user ID.

AssetLog->Adobe API: POST /ims/validate_token/
Adobe API-->AssetLog: {token: {user_id: "xxx"}, ...}

note right of AssetLog: The auth token gets stored in the session, so\n subsequent requests from the browser can be\nassociated with this user.

AssetLog-->Browser: /authenticate OK

note right of Browser: The user is authenticated now, time to show \n them the events page.

Browser->AssetLog: GET /events
AssetLog-->Browser: HTML + events.js

note right of Browser: User clicks "Register webhook"\n The button triggers an AJAX call

Browser->AssetLog: POST /create_webhook (ajax)


note right of AssetLog: Use the auth token to create\n a webhook on behalf of the user.
AssetLog->Adobe API: POST /csm/webhooks

Adobe API->AssetLog: GET /webhook?challenge=<random string>
note left of Adobe API: Abode sends us a challenge request \nto make sure our webhook works.
AssetLog-->Adobe API: <random string>
note left of Adobe API: The challenge looks good, respond\n with the webhook data
Adobe API-->AssetLog: {status: "VERIFIED", ...}
AssetLog-->Browser: /create_webhook OK
note left of Adobe API: Now whenever the user makes change\n in Adobe Creative Assets, the webhook\ngets called.
Adobe API->AssetLog: POST /webhook {type:"asset_created", filename:"..."}

#https://bramp.github.io/js-sequence-diagrams/
]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="100" height="38" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="20" y="45" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="20">AssetLog</tspan></text></g><g class="actor"><rect x="10" y="1932.0000190734863" width="100" height="38" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="20" y="1957.0000190734863" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="20">AssetLog</tspan></text></g><line x1="60" x2="60" y1="58" y2="1932.0000190734863" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="535" y="20" width="90" height="38" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="545" y="45" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="545">Browser</tspan></text></g><g class="actor"><rect x="535" y="1932.0000190734863" width="90" height="38" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="545" y="1957.0000190734863" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="545">Browser</tspan></text></g><line x1="580" x2="580" y1="58" y2="1932.0000190734863" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="1145" y="20" width="110" height="38" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="1155" y="45" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="1155">Adobe API</tspan></text></g><g class="actor"><rect x="1145" y="1932.0000190734863" width="110" height="38" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="1155" y="1957.0000190734863" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="1155">Adobe API</tspan></text></g><line x1="1200" x2="1200" y1="58" y2="1932.0000190734863" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="note"><rect x="600" y="78" width="410" height="28" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="605" y="98" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="605">User visits https://assetlog.example.com</tspan></text></g><g class="signal"><text x="295" y="137" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="295">GET /</tspan></text><line x1="580" x2="60" y1="144" y2="144" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="245" y="175" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="245">HTML + index.js</tspan></text><line x1="60" x2="580" y1="182" y2="182" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="600" y="202" width="500" height="47.20000076293945" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="605" y="222" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="605">Upon page load it will use the Adobe Creative SDK</tspan><tspan dy="1.2em" x="605">to check if the user is alread authenticated.</tspan></text></g><g class="signal"><text x="755" y="280.20000076293945" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="755">CreativeSDK.getAuthStatus()</tspan></text><line x1="580" x2="1200" y1="287.20000076293945" y2="287.20000076293945" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="765" y="318.20000076293945" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="765">AuthStatus: not logged in</tspan></text><line x1="1200" x2="580" y1="325.20000076293945" y2="325.20000076293945" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="600" y="345.20000076293945" width="320" height="28" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="605" y="365.20000076293945" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="605">User clicks "Log in with Adobe"</tspan></text></g><g class="signal"><text x="795" y="404.20000076293945" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="795">CreativeSDK.login()</tspan></text><line x1="580" x2="1200" y1="411.20000076293945" y2="411.20000076293945" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="600" y="431.20000076293945" width="580" height="47.20000076293945" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="605" y="451.20000076293945" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="605">Opens a popup window to request authentication.</tspan><tspan dy="1.2em" x="605">When that's done, it gets redirected to /redirectims.html</tspan></text></g><g class="signal"><text x="140" y="509.4000015258789" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="140">(popup window) GET /redirectims.html</tspan></text><line x1="580" x2="60" y1="516.4000015258789" y2="516.4000015258789" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="225" y="547.4000015258789" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="225">HTML + csdk_auth.js</tspan></text><line x1="60" x2="580" y1="554.4000015258789" y2="554.4000015258789" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="600" y="574.4000015258789" width="470" height="85.60000610351562" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="605" y="594.4000015258789" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="605">This page includes some JavaScript provided by</tspan><tspan dy="1.2em" x="605">Adobe. It sends a message to the original</tspan><tspan dy="1.2em" x="605">window that login has succeeded, then closes</tspan><tspan dy="1.2em" x="605">the popup window.</tspan></text></g><g class="signal"><text x="790" y="691.0000076293945" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="790">Auth OK, close popup</tspan></text><line x1="1200" x2="580" y1="698.0000076293945" y2="698.0000076293945" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="195" y="729.0000076293945" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="195">POST /authenticate (ajax)</tspan></text><line x1="580" x2="60" y1="736.0000076293945" y2="736.0000076293945" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="80" y="756.0000076293945" width="480" height="104.80000305175781" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="85" y="776.0000076293945" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="85">Authentication up to this point  was strictly</tspan><tspan dy="1.2em" x="85">on the frontend. With this call the server</tspan><tspan dy="1.2em" x="85">gets notified that authenication has succeeded,</tspan><tspan dy="1.2em" x="85">and receives the authentication token, which</tspan><tspan dy="1.2em" x="85">it can use to make API calls.</tspan></text></g><g class="note"><rect x="80" y="880.8000106811523" width="470" height="66.4000015258789" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="85" y="900.8000106811523" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="85">On the server side, do an API call to Adobe to</tspan><tspan dy="1.2em" x="85">validate the authentication token, and to get</tspan><tspan dy="1.2em" x="85">the corresponding user ID.</tspan></text></g><g class="signal"><text x="505" y="978.2000122070312" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="505">POST /ims/validate_token/</tspan></text><line x1="60" x2="1200" y1="985.2000122070312" y2="985.2000122070312" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="480" y="1016.2000122070312" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="480">{token: {user_id: "xxx"}, ...}</tspan></text><line x1="1200" x2="60" y1="1023.2000122070312" y2="1023.2000122070312" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="80" y="1043.2000122070312" width="460" height="66.4000015258789" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="85" y="1063.2000122070312" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="85">The auth token gets stored in the session, so</tspan><tspan dy="1.2em" x="85">subsequent requests from the browser can be</tspan><tspan dy="1.2em" x="85">associated with this user.</tspan></text></g><g class="signal"><text x="240" y="1140.6000137329102" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="240">/authenticate OK</tspan></text><line x1="60" x2="580" y1="1147.6000137329102" y2="1147.6000137329102" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="600" y="1167.6000137329102" width="440" height="47.20000076293945" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="605" y="1187.6000137329102" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="605">The user is authenticated now, time to show</tspan><tspan dy="1.2em" x="605">them the events page.</tspan></text></g><g class="signal"><text x="265" y="1245.8000144958496" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="265">GET /events</tspan></text><line x1="580" x2="60" y1="1252.8000144958496" y2="1252.8000144958496" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="240" y="1283.8000144958496" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="240">HTML + events.js</tspan></text><line x1="60" x2="580" y1="1290.8000144958496" y2="1290.8000144958496" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="600" y="1310.8000144958496" width="330" height="47.20000076293945" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="605" y="1330.8000144958496" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="605">User clicks "Register webhook"</tspan><tspan dy="1.2em" x="605">The button triggers an AJAX call</tspan></text></g><g class="signal"><text x="185" y="1389.000015258789" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="185">POST /create_webhook (ajax)</tspan></text><line x1="580" x2="60" y1="1396.000015258789" y2="1396.000015258789" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="80" y="1416.000015258789" width="330" height="47.20000076293945" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="85" y="1436.000015258789" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="85">Use the auth token to create</tspan><tspan dy="1.2em" x="85">a webhook on behalf of the user.</tspan></text></g><g class="signal"><text x="540" y="1494.2000160217285" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="540">POST /csm/webhooks</tspan></text><line x1="60" x2="1200" y1="1501.2000160217285" y2="1501.2000160217285" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="440" y="1532.2000160217285" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="440">GET /webhook?challenge=&lt;random string&gt;</tspan></text><line x1="1200" x2="60" y1="1539.2000160217285" y2="1539.2000160217285" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="830" y="1559.2000160217285" width="350" height="47.20000076293945" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="835" y="1579.2000160217285" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="835">Abode sends us a challenge request</tspan><tspan dy="1.2em" x="835">to make sure our webhook works.</tspan></text></g><g class="signal"><text x="555" y="1637.400016784668" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="555">&lt;random string&gt;</tspan></text><line x1="60" x2="1200" y1="1644.400016784668" y2="1644.400016784668" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="840" y="1664.400016784668" width="340" height="47.20000076293945" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="845" y="1684.400016784668" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="845">The challenge looks good, respond</tspan><tspan dy="1.2em" x="845">with the webhook data</tspan></text></g><g class="signal"><text x="505" y="1742.6000175476074" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="505">{status: "VERIFIED", ...}</tspan></text><line x1="1200" x2="60" y1="1749.6000175476074" y2="1749.6000175476074" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="230" y="1780.6000175476074" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="230">/create_webhook OK</tspan></text><line x1="60" x2="580" y1="1787.6000175476074" y2="1787.6000175476074" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="800" y="1807.6000175476074" width="380" height="66.4000015258789" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="805" y="1827.6000175476074" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="805">Now whenever the user makes change</tspan><tspan dy="1.2em" x="805">in Adobe Creative Assets, the webhook</tspan><tspan dy="1.2em" x="805">gets called.</tspan></text></g><g class="signal"><text x="370" y="1905.0000190734863" style="font-size: 16px; font-family: Andale Mono,monospace;"><tspan x="370">POST /webhook {type:"asset_created", filename:"..."}</tspan></text><line x1="1200" x2="60" y1="1912.0000190734863" y2="1912.0000190734863" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g></svg>